<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html style="width:100%;height:100%">
<head>
    <title></title>
<style>
  .div01{width:100%; height:100%; position:relative;}
  .div02{background:#FF0000; color:#FFFFFF; position:absolute; left:50%; top:50%; margin:-100px 0 0 -100px; width:200px; height:200px;}
 </style>


    <link href="easyui/css/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="easyui/css/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="easyui/css/demo.css" rel="stylesheet" type="text/css" />
    <link href="easyui/css/dlg.css" rel="stylesheet" type="text/css" />
    <script src="easyui/js/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="easyui/js/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="easyui/js/easyui-lang-zh_CN.js" type="text/javascript"></script>

    <script src="common.js" type="text/javascript"></script>

    <script type="text/javascript">


        function Save_Excel() {//导出Excel文件
            //getExcelXML有一个JSON对象的配置，配置项看了下只有title配置，为excel文档的标题
            var data = $('#tab').datagrid('getExcelXml', { title: ' 维修记录' }); //获取datagrid数据对应的excel需要的xml格式的内容

            $.post("wxjl.ashx", { "action": "export", data: data }, function (data) {
                window.location = data; //执行下载操作
                //$.messager.alert("提示", "导出excel成功！");
            });
            return false;
        }

        //高级查询
        function search_dg() {
            //表单清空
            //不能使用表单清空，原因是该语句生效后，还能获取上次表单留下的内容，与查询条件不符，所以该语句注释掉
            //$("#fm_search")[0].reset();       

            //显示
            $("#div_search").show();

            //以窗体的形式展示
            $("#div_search").dialog({
                title: "高级查询", //标题
                iconCls: "icon-search", //图标
                width: 600, //窗体的宽度
                height: 350, //窗体的高度
                modal: true, //遮罩层
                //按钮集合
                buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //将数据序列化
                    var parm = $("#fm_search").serialize();
                    //中文格式转换
                    var pp = decodeURIComponent(parm, true);

                    $("#tab_device").treegrid('load', { "action": "search", data: pp });

                    $("#div_search").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div_search").window("close");
                  }
              }
            ]
            });
        }

        //选择设备
        function selectDevice() {
            //表单清空
            $("#form2")[0].reset();
            //显示
            $("#div2").show();
            //以窗体的形式展示
            $("#div2").dialog({
                title: "选择设备", //标题
                iconCls: "icon-ok", //图标
                width: 850, //窗体的宽度
                height: 500, //窗体的高度
                modal: true, //遮罩层
                //按钮集合
                buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //获取选定行
                    var selected = $('#tab_device').treegrid('getSelected');

                    if (selected != null) {
                        $("#csbbh").val(selected.csbbh);
                        $("#csbmc").val(selected.csbmc);
                        $("#cscx").val(selected.cscx);
                        $("#czy").val(selected.csszy);
                    }

                    $("#div2").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div2").window("close");
                  }
              }
            ]
            });
      }


      //选择员工
      function selectPerson() {
          //表单清空
          $("#form4")[0].reset();
          //显示
          $("#div4").show();
          //以窗体的形式展示
          $("#div4").dialog({
              title: "选择员工", //标题
              iconCls: "icon-ok", //图标
              width: 850, //窗体的宽度
              height: 500, //窗体的高度
              modal: true, //遮罩层
              //按钮集合
              buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //获取选定行
                    var selected = $('#tab_person').datagrid('getSelected');

                    if (selected != null) {
                        $("#cwxr").val(selected.JSON_cygbh + "-" + selected.JSON_cygxm);
                    }

                    $("#div4").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div4").window("close");
                  }
              }
            ]
          });
      }


      //选择员工
      function selPerson() {
          //表单清空
          $("#form5")[0].reset();
          //显示
          $("#div5").show();
          //以窗体的形式展示
          $("#div5").dialog({
              title: "选择员工", //标题
              iconCls: "icon-ok", //图标
              width: 850, //窗体的宽度
              height: 500, //窗体的高度
              modal: true, //遮罩层
              //按钮集合
              buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //获取所有选定行
                    var selected = $('#tab_per').datagrid('getSelections');
                    var parms = "";

                    if (selected != null) {
                        for (var i = 0; i < selected.length; i++) {

                            parms = parms + "," + selected[i].JSON_cygbh + "-" + selected[i].JSON_cygxm;
                        }

                        $("#cfzry").val(parms.substring(1, parms.length));
                    }

                    $("#div5").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div5").window("close");
                  }
              }
            ]
          });
      }


      //选择员工
      function selemployee() {
          //表单清空
          $("#form6")[0].reset();
          //显示
          $("#div6").show();
          //以窗体的形式展示
          $("#div6").dialog({
              title: "选择员工", //标题
              iconCls: "icon-ok", //图标
              width: 850, //窗体的宽度
              height: 500, //窗体的高度
              modal: true, //遮罩层
              //按钮集合
              buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //获取所有选定行
                    var selected = $('#tab_employee').datagrid('getSelections');
                    var parms = "";

                    if (selected != null) {
                        for (var i = 0; i < selected.length; i++) {

                            parms = parms + "," + selected[i].JSON_cygbh + "-" + selected[i].JSON_cygxm;
                        }

                        $("#d_cdbr").val(parms.substring(1, parms.length));
                    }

                    $("#div6").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div6").window("close");
                  }
              }
            ]
          });
      }

        function formatOper() {
            return '<a href="#" class="easyui-linkbutton l-btn l-btn-plain" onclick="selectRow()"><img src="../easyui/css/themes/icons/search.gif" border=0/></a>';
        }

        function selectRow() {
            //表单清空
            $("#form1")[0].reset();
            //显示
            $("#div1").show();
            //以窗体的形式展示
            $("#div1").dialog({
                title: "选择备件", //标题
                iconCls: "icon-ok", //图标
                width: 850, //窗体的宽度
                height: 500, //窗体的高度
                modal: true, //遮罩层
                //按钮集合
                buttons: [
            {
                text: "确定", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //获取选定行
                    var selected = $('#tab_select').datagrid('getSelected');

                    //回传至编辑窗口
                    var row = $('#tab2').datagrid('getSelected');
                    if (row) {
                        var i = $('#tab2').datagrid('getRowIndex', row);

                        // 得到columns对象
                        var columns = $('#tab2').datagrid("options").columns;
                        // 得到rows对象
                        var rows = $('#tab2').datagrid("getRows"); // 这段代码是
                        // 对某个单元格赋值
                        rows[i][columns[0][1].field] = selected.JSON_id;
                        rows[i][columns[0][2].field] = selected.JSON_cbjbh;
                        rows[i][columns[0][3].field] = selected.JSON_cbjmc;
                        rows[i][columns[0][5].field] = selected.JSON_ibjsl;
                        // 刷新该行, 只有刷新了才有效果
                        $('#tab2').datagrid('refreshRow', i);
                    }

                    $("#div1").window("close");
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#div1").window("close");
                  }
              }
            ]
            });

        }

        $(function () {
            //            var myDate = new Date();
            //            //使用服务器函数返回日期
            //            $.post("getDate.ashx", { data: myDate.toLocaleDateString() }, function (data) {
            //                $('#dqsrq').datebox('setValue', data);
            //                $('#djzrq').datebox('setValue', data);
            //            });

            $('#dqsrq').datebox('setValue', getCurDate());
            $('#djzrq').datebox('setValue', getCurDate());


            //自动隐藏west部分
            //----------------------------------------------------
            $(".layout-button-left").live("click", function () {
            });

            $(".layout-button-left").click();

            //----------------------------------------------------

            /**
            Jquery easyui datagrid js导出excel
            修改自extgrid导出excel
            * allows for downloading of grid data (store) directly into excel
            * Method: extracts data of gridPanel store, uses columnModel to construct XML excel document,
            * converts to Base64, then loads everything into a data URL link.
            *
            * @author Animal <extjs support team>
            *
            */
            $.extend($.fn.datagrid.methods, {
                getExcelXml: function (jq, param) {
                    var worksheet = this.createWorksheet(jq, param);
                    //alert($(jq).datagrid('getColumnFields'));
                    var totalWidth = 0;
                    var cfs = $(jq).datagrid('getColumnFields');
                    for (var i = 1; i < cfs.length; i++) {
                        totalWidth += $(jq).datagrid('getColumnOption', cfs[i]).width;
                    }
                    //var totalWidth = this.getColumnModel().getTotalWidth(includeHidden);
                    return '<?xml version="1.0" encoding="utf-8"?>' + //xml申明有问题，以修正，注意是utf-8编码，如果是gb2312，需要修改动态页文件的写入编码
            '<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">' +
            '<o:DocumentProperties><o:Title>' + param.title + '</o:Title></o:DocumentProperties>' +
            '<ss:ExcelWorkbook>' +
            '<ss:WindowHeight>' + worksheet.height + '</ss:WindowHeight>' +
            '<ss:WindowWidth>' + worksheet.width + '</ss:WindowWidth>' +
            '<ss:ProtectStructure>False</ss:ProtectStructure>' +
            '<ss:ProtectWindows>False</ss:ProtectWindows>' +
            '</ss:ExcelWorkbook>' +
            '<ss:Styles>' +
            '<ss:Style ss:ID="Default">' +
            '<ss:Alignment ss:Vertical="Top"  />' +
            '<ss:Font ss:FontName="arial" ss:Size="10" />' +
            '<ss:Borders>' +
            '<ss:Border  ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Top" />' +
            '<ss:Border  ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Bottom" />' +
            '<ss:Border  ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Left" />' +
            '<ss:Border ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Right" />' +
            '</ss:Borders>' +
            '<ss:Interior />' +
            '<ss:NumberFormat />' +
            '<ss:Protection />' +
            '</ss:Style>' +
            '<ss:Style ss:ID="title">' +
            '<ss:Borders />' +
            '<ss:Font />' +
            '<ss:Alignment  ss:Vertical="Center" ss:Horizontal="Center" />' +
            '<ss:NumberFormat ss:Format="@" />' +
            '</ss:Style>' +
            '<ss:Style ss:ID="headercell">' +
            '<ss:Font ss:Bold="1" ss:Size="10" />' +
            '<ss:Alignment  ss:Horizontal="Center" />' +
            '<ss:Interior ss:Pattern="Solid"  />' +
            '</ss:Style>' +
            '<ss:Style ss:ID="even">' +
            '<ss:Interior ss:Pattern="Solid"  />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="even" ss:ID="evendate">' +
            '<ss:NumberFormat ss:Format="yyyy-mm-dd" />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="even" ss:ID="evenint">' +
            '<ss:NumberFormat ss:Format="0" />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="even" ss:ID="evenfloat">' +
            '<ss:NumberFormat ss:Format="0.00" />' +
            '</ss:Style>' +
            '<ss:Style ss:ID="odd">' +
            '<ss:Interior ss:Pattern="Solid"  />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="odd" ss:ID="odddate">' +
            '<ss:NumberFormat ss:Format="yyyy-mm-dd" />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="odd" ss:ID="oddint">' +
            '<ss:NumberFormat ss:Format="0" />' +
            '</ss:Style>' +
            '<ss:Style ss:Parent="odd" ss:ID="oddfloat">' +
            '<ss:NumberFormat ss:Format="0.00" />' +
            '</ss:Style>' +
            '</ss:Styles>' +
            worksheet.xml +
            '</ss:Workbook>';
                },
                createWorksheet: function (jq, param) {
                    // Calculate cell data types and extra class names which affect formatting
                    var cellType = [];
                    var cellTypeClass = [];
                    //var cm = this.getColumnModel();
                    var totalWidthInPixels = 0;
                    var colXml = '';
                    var headerXml = '';
                    var visibleColumnCountReduction = 0;
                    var cfs = $(jq).datagrid('getColumnFields');
                    var colCount = cfs.length;
                    for (var i = 1; i < colCount; i++) {
                        if (cfs[i] != '') {
                            var w = $(jq).datagrid('getColumnOption', cfs[i]).width;
                            totalWidthInPixels += w;
                            if (cfs[i] === "") {
                                cellType.push("None");
                                cellTypeClass.push("");
                                ++visibleColumnCountReduction;
                            }
                            else {
                                colXml += '<ss:Column ss:AutoFitWidth="1" ss:Width="130" />';
                                headerXml += '<ss:Cell ss:StyleID="headercell">' +
                        '<ss:Data ss:Type="String">' + $(jq).datagrid('getColumnOption', cfs[i]).title + '</ss:Data>' +
                        '<ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>';
                                cellType.push("String");
                                cellTypeClass.push("");
                            }
                        }
                    }
                    var visibleColumnCount = cellType.length - visibleColumnCountReduction;
                    var result = {
                        height: 9000,
                        width: Math.floor(totalWidthInPixels * 30) + 50
                    };
                    var rows = $(jq).datagrid('getRows');
                    // Generate worksheet header details.
                    var t = '<ss:Worksheet ss:Name="' + param.title + '">' +
            '<ss:Names>' +
            '<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'' + param.title + '\'!R1:R2" />' +
            '</ss:Names>' +
            '<ss:Table x:FullRows="1" x:FullColumns="1"' +
            ' ss:ExpandedColumnCount="' + (visibleColumnCount + 2) +
            '" ss:ExpandedRowCount="' + (rows.length + 2) + '">' +
            colXml +
            '<ss:Row ss:AutoFitHeight="1">' +
            headerXml +
            '</ss:Row>';
                    // Generate the data rows from the data in the Store
                    //for (var i = 0, it = this.store.data.items, l = it.length; i < l; i++) {
                    for (var i = 0, it = rows, l = it.length; i < l; i++) {
                        t += '<ss:Row>';
                        var cellClass = (i & 1) ? 'odd' : 'even';
                        r = it[i];
                        var k = 0;
                        for (var j = 1; j < colCount; j++) {
                            //if ((cm.getDataIndex(j) != '')
                            if (cfs[j] != '') {
                                //var v = r[cm.getDataIndex(j)];
                                var v = r[cfs[j]];
                                if (cellType[k] !== "None") {
                                    t += '<ss:Cell ss:StyleID="' + cellClass + cellTypeClass[k] + '"><ss:Data ss:Type="' + cellType[k] + '">';
                                    if (cellType[k] == 'DateTime') {
                                        t += v.format('Y-m-d');
                                    } else {
                                        t += v;
                                    }
                                    t += '</ss:Data></ss:Cell>';
                                }
                                k++;
                            }
                        }
                        t += '</ss:Row>';
                    }
                    result.xml = t + '</ss:Table>' +
            '<x:WorksheetOptions>' +
            '<x:PageSetup>' +
            '<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />' +
            '<x:Footer x:Data="Page &P of &N" x:Margin="0.5" />' +
            '<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />' +
            '</x:PageSetup>' +
            '<x:FitToPage />' +
            '<x:Print>' +
            '<x:PrintErrors>Blank</x:PrintErrors>' +
            '<x:FitWidth>1</x:FitWidth>' +
            '<x:FitHeight>32767</x:FitHeight>' +
            '<x:ValidPrinterInfo />' +
            '<x:VerticalResolution>600</x:VerticalResolution>' +
            '</x:Print>' +
            '<x:Selected />' +
            '<x:DoNotDisplayGridlines />' +
            '<x:ProtectObjects>False</x:ProtectObjects>' +
            '<x:ProtectScenarios>False</x:ProtectScenarios>' +
            '</x:WorksheetOptions>' +
            '</ss:Worksheet>';
                    return result;
                }
            });


            $("#tt").tree({//同步加载Tree
                url: 'sbfl.ashx?action=0',
                lines: true,
                onBeforeExpand: function (node, param) {        //异步加载设备资料

                    $('#tt').tree('options').url = 't_sbzl.ashx?action=' + node.id;
                },
                onSelect: function (node) {
                    if ($('#tt').tree('isLeaf', node.target)) {      //是否叶子节点
                        //$('#tab').datagrid('load', { "action": "query", sb: node.id });

                        var qsrq = $('#dqsrq').datebox('getValue');
                        var jzrq = $('#djzrq').datebox('getValue');
                        $('#tab').datagrid('load', { "action": "query", sb: node.id, qsrq: qsrq, jzrq: jzrq, state: "s" });
                    }
                }
            });

            $('#d_csxlx').combobox({
                url: 'common.ashx?action=3',
                method: 'get',
                valueField: 'id',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: false,
                required: true
            });

            $('#cgzlx').combotree({
                url: 'gzxx_load.ashx',
                method: 'get',
                valueField: 'id',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: false
                //                ,
                //                onSelect: function (node) {

                //                    var parm = node.id;

                //                    if (parm == "" || parm == null) {
                //                        $.messager.alert("提示", "故障类型不允许为空，请选择！");
                //                        return;
                //                    }

                //                    var url = "clfs_load.ashx?data=" + parm;

                //                    //中文格式转换
                //                    var pp = decodeURIComponent(parm, true);
                //                    //post异步提交
                //                    $.post("wxjl_vali.ashx", { data: pp }, function (data) {
                //                        if (data == "1") {
                //                            $('#cclfs').combobox('setValue', '');
                //                            return;
                //                        }
                //                        if (data == "2") {
                //                            $('#cclfs').combobox('setValue', '');
                //                            return;
                //                        }
                //                    });


                //                    $('#cclfs').combobox('reload', url);

                //                }
            });

            //            $('#cclfs').combobox({
            //                method: 'get',
            //                valueField: 'id',
            //                textField: 'text',
            //                panelWidth: 350,
            //                panelHeight: 'auto',
            //                editable: false
            //            });

            //            $('#cwxr').combobox({
            //                url: 'ygzl_load.ashx?action=1',
            //                method: 'get',
            //                valueField: 'text',
            //                textField: 'text',
            //                panelWidth: 350,
            //                panelHeight: 'auto',
            //                editable: false
            //            });


            $('#s_csbfl').combotree({
                url: 'sbfl.ashx',     //显示最末级分类
                method: 'get',
                valueField: 'id',
                textField: 'text',
                editable: true
            });


            $('#s_csbdj').combobox({
                url: 'common.ashx?action=2',
                method: 'get',
                valueField: 'text',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: true
            });

            $('#s_csbzt').combobox({
                url: 'common.ashx?action=1',
                method: 'get',
                valueField: 'text',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: true
            });


            $('#s_cbmmc').combotree({
                url: 'bmzl.ashx',
                method: 'get',
                valueField: 'id',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: true
            });


            $('#s_csszy').combobox({
                url: 'sszy.ashx?action=1',
                method: 'get',
                valueField: 'id',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: true
            });

            $('#s_cscx').combobox({
                url: 'scx.ashx?action=1',
                method: 'get',
                valueField: 'id',
                textField: 'text',
                panelWidth: 350,
                panelHeight: 'auto',
                editable: true
            });

            $("#tab_select").datagrid({
                width: 825,
                height: 425,
                singleSelect: true, //选中一行的设置
                rownumbers: true, //行号
                url: "sbzl_bj.ashx", //请求路径
                title: "备件资料", //标题
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //列
                columns: [[
                { field: "JSON_id", title: "备件id", width: 100, hidden: true },
                { field: "JSON_cbjbh", title: "备件编号", width: 100 },
                { field: "JSON_cbjmc", title: "备件名称", width: 100 },
                { field: "JSON_cggxh", title: "规格型号", width: 100 },
                { field: "JSON_cjscs", title: "技术参数", width: 100 },
                { field: "JSON_csszy", title: "所属专业", width: 100 },
                { field: "JSON_cbjdj", title: "备件等级", width: 100 },
                { field: "JSON_csccj", title: "生产厂家", width: 100 },
                { field: "JSON_ibjsl", title: "备件数量", width: 100 },
                { field: "JSON_cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query" },
                pagination: true,
                toolbar: "#tool_select"
            });
            $("#tab_select").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
            });

            $("#tab_device").treegrid({
                width: 825,
                height: 425,
                singleSelect: true, //选中一行的设置
                rownumbers: true, //行号
                url: "sbzl.ashx", //请求路径
                title: "设备资料", //标题
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //列
                columns: [[
                { field: "csbfl", title: "设备分类", width: 80 },
                { field: "csbbh", title: "设备编号", width: 150 },
                { field: "csbmc", title: "设备名称", width: 150 },
                { field: "csbsbh", title: "RFID码", width: 100 },
                { field: "cscx", title: "生产线", width: 100 },
                { field: "csbzt", title: "设备状态", width: 100 },
                { field: "csbdj", title: "设备等级", width: 100 },
                { field: "cbmmc", title: "部门", width: 100 },
                { field: "csszy", title: "所属专业", width: 100 },
                { field: "csdwz", title: "上端位置", width: 100 },
                { field: "csbxh", title: "设备型号", width: 100 },
                { field: "cjscs", title: "技术参数", width: 100 },
                { field: "csccj", title: "生产厂家", width: 100 },
                { field: "izjsl", title: "装机数量", width: 100 },
                { field: "cazdd", title: "安装地点", width: 100 },
                { field: "dtyrq", title: "投用日期", width: 100, formatter: myformatter },
                { field: "cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query" },
                pagination: true,
                toolbar: "#tool_device"
            });
            $("#tab_device").treegrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
            });

            $("#tab_person").datagrid({
                width: 825,
                height: 425,
                singleSelect: true, //选中一行的设置
                rownumbers: true, //行号
                url: "ygzl.ashx", //请求路径
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                //title: "员工资料", //标题
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //
                columns: [[
                { field: "JSON_ibmid", title: "部门id", hidden: "true" },
                { field: "JSON_izwid", title: "职位id", hidden: "true" },
                { field: "JSON_cygbh", title: "员工编号", width: 80 },
                { field: "JSON_cygxm", title: "员工姓名", width: 100 },
                { field: "JSON_cdlmm", title: "登陆密码", width: 100, hidden: "true" },
                { field: "JSON_cbmmc", title: "部门名称", width: 100 },
                { field: "JSON_czw", title: "职位", width: 100 },
                { field: "JSON_cxb", title: "性别", width: 100 },
                { field: "JSON_cnl", title: "年龄", width: 100 },
                { field: "JSON_drzsj", title: "入职时间", width: 100, formatter: myformatter },
                { field: "JSON_cbyyx", title: "毕业院校", width: 100 },
                { field: "JSON_czy", title: "专业", width: 100 },
                { field: "JSON_csfzh", title: "身份证号", width: 100 },
                { field: "JSON_clxdh", title: "联系电话", width: 100 },
                { field: "JSON_cjjlxr", title: "紧急联系人", width: 100 },
                { field: "JSON_cjjlxrdh", title: "紧急联系人电话", width: 100 },
                { field: "JSON_cczyf", title: "操作员否", width: 100 },
                { field: "JSON_cwxh", title: "微信号", width: 100 },
                { field: "JSON_czt", title: "状态", width: 80 },
                { field: "JSON_cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query" },
                pagination: true,
                toolbar: "#tool_person"
            });
            $("#tab_person").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'

            });


            $("#tab_per").datagrid({
                width: 825,
                height: 425,
                singleSelect: false, //选中一行的设置
                rownumbers: true, //行号
                url: "ygzl.ashx", //请求路径
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                //title: "员工资料", //标题
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //
                columns: [[
                { field: "JSON_ibmid", title: "部门id", hidden: "true" },
                { field: "JSON_izwid", title: "职位id", hidden: "true" },
                { field: "JSON_cygbh", title: "员工编号", width: 80 },
                { field: "JSON_cygxm", title: "员工姓名", width: 100 },
                { field: "JSON_cdlmm", title: "登陆密码", width: 100, hidden: "true" },
                { field: "JSON_cbmmc", title: "部门名称", width: 100 },
                { field: "JSON_czw", title: "职位", width: 100 },
                { field: "JSON_cxb", title: "性别", width: 100 },
                { field: "JSON_cnl", title: "年龄", width: 100 },
                { field: "JSON_drzsj", title: "入职时间", width: 100, formatter: myformatter },
                { field: "JSON_cbyyx", title: "毕业院校", width: 100 },
                { field: "JSON_czy", title: "专业", width: 100 },
                { field: "JSON_csfzh", title: "身份证号", width: 100 },
                { field: "JSON_clxdh", title: "联系电话", width: 100 },
                { field: "JSON_cjjlxr", title: "紧急联系人", width: 100 },
                { field: "JSON_cjjlxrdh", title: "紧急联系人电话", width: 100 },
                { field: "JSON_cczyf", title: "操作员否", width: 100 },
                { field: "JSON_cwxh", title: "微信号", width: 100 },
                { field: "JSON_czt", title: "状态", width: 80 },
                { field: "JSON_cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query" },
                pagination: true,
                toolbar: "#tool_per"
            });
            $("#tab_per").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'

            });

            $("#tab_employee").datagrid({
                width: 825,
                height: 425,
                singleSelect: false, //选中一行的设置
                rownumbers: true, //行号
                url: "ygzl.ashx", //请求路径
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                //title: "员工资料", //标题
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //
                columns: [[
                { field: "JSON_ibmid", title: "部门id", hidden: "true" },
                { field: "JSON_izwid", title: "职位id", hidden: "true" },
                { field: "JSON_cygbh", title: "员工编号", width: 80 },
                { field: "JSON_cygxm", title: "员工姓名", width: 100 },
                { field: "JSON_cdlmm", title: "登陆密码", width: 100, hidden: "true" },
                { field: "JSON_cbmmc", title: "部门名称", width: 100 },
                { field: "JSON_czw", title: "职位", width: 100 },
                { field: "JSON_cxb", title: "性别", width: 100 },
                { field: "JSON_cnl", title: "年龄", width: 100 },
                { field: "JSON_drzsj", title: "入职时间", width: 100, formatter: myformatter },
                { field: "JSON_cbyyx", title: "毕业院校", width: 100 },
                { field: "JSON_czy", title: "专业", width: 100 },
                { field: "JSON_csfzh", title: "身份证号", width: 100 },
                { field: "JSON_clxdh", title: "联系电话", width: 100 },
                { field: "JSON_cjjlxr", title: "紧急联系人", width: 100 },
                { field: "JSON_cjjlxrdh", title: "紧急联系人电话", width: 100 },
                { field: "JSON_cczyf", title: "操作员否", width: 100 },
                { field: "JSON_cwxh", title: "微信号", width: 100 },
                { field: "JSON_czt", title: "状态", width: 80 },
                { field: "JSON_cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query" },
                pagination: true,
                toolbar: "#tool_employee"
            });
            $("#tab_employee").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'

            });


            $("#tab").datagrid({
                fit: true,
                width: $(panel2).width(),
                height: $(panel2).height(),
                singleSelect: true, //选中一行的设置
                rownumbers: true, //行号
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                url: "wxjl.ashx", //请求路径
                //title: "维修记录", //标题
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //列
                columns: [[
                { field: "JSON_igzlx", title: "故障类型id", width: 100, hidden: true },
                { field: "JSON_cgdh", title: "工单号", width: 200 },
                { field: "JSON_drq", title: "日期", width: 80, formatter: myformatter },
                { field: "JSON_csbbh", title: "设备编号", width: 100 },
                { field: "JSON_csbmc", title: "设备名称", width: 100 },
                { field: "JSON_cscx", title: "生产线", width: 100 },
                { field: "JSON_czy", title: "专业", width: 100 },
                { field: "JSON_dgzsj", title: "故障时间", width: 80 },
                { field: "JSON_cgzlx", title: "故障类型", width: 100 },
                { field: "JSON_cgzxx", title: "故障现象", width: 100 },
                { field: "JSON_cclfs", title: "处理方式", width: 100 },
                { field: "JSON_cwxr", title: "作业人", width: 100 },
                { field: "JSON_cczy", title: "制单人", width: 100 },
                { field: "JSON_cfzry", title: "辅助人员", width: 100 },
                { field: "JSON_cwxnr", title: "维修内容", width: 300 },
                { field: "JSON_dwxkssj", title: "维修开始时间", width: 80 },
                { field: "JSON_dwcsj", title: "完成时间", width: 80 },
                { field: "JSON_cbz", title: "备注", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query", sb: 0,state:'' },
                pagination: true,
                toolbar: "#tool",
                onDblClickRow: function () {
                    edit_dg();  //行双击调用修改函数
                },
                onLoadSuccess: function (data) {
                    $('#tab').datagrid('doCellTip', { cls: { 'background-color': 'white' }, delay: 500 });  //浮动显示
                }
            });
            $("#tab").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                   
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
            });


            $("#tab2").datagrid({
                width: 800,
                height: 230,
                singleSelect: true, //选中一行的设置
                rownumbers: true, //行号
                nowrap: false,
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表  
                url: "wxjl_mx.ashx", //请求路径
                title: "备件更换记录", //标题
                //iconCls: "icon-save", //图标
                //collapsible: true, //隐藏按钮
                loadMsg: '正在加载,请稍后...',
                //冻结列
                frozenColumns: [[{ field: "chk", "checkbox": true}]],
                //列
                columns: [[
                { field: 'opt', title: '操作', width: 50, align: 'center',
                    formatter: formatOper
                },
                { field: "JSON_ibjid", title: "备件id", width: 100, hidden: true },
                { field: "JSON_cbjbh", title: "备件编号", width: 100 },
                { field: "JSON_cbjmc", title: "备件名称", width: 100 },
                { field: "JSON_ibjsl", title: "使用数量", width: 100, editor: { type: 'numberbox', options: { precision: 2}} },
                { field: "JSON_isysl", title: "剩余数量", width: 100 }
                ]],
                //传输参数
                queryParams: { "action": "query", wxid: 0 },
                pagination: true,
                toolbar: "#tool2",
                onDblClickRow: function () {
                    edit_mx();  //行双击调用修改函数
                }
            });
            $("#tab2").datagrid('getPager').pagination({
                pageSize: 10, //每页显示的记录条数                       
                pageList: [10, 20, 30, 40, 50], //设置每页记录条数的列表                           
                beforePageText: '第', //页数文本框前显示的汉字                           
                afterPageText: '页    共 {pages} 页',
                displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'

            });

            $("#ipt_search2").searchbox({
                width: 200,
                iconCls: 'icon-save',
                searcher: function (val, name) {
                    $('#tab_select').datagrid('options').queryParams.search_type = name;
                    $('#tab_select').datagrid('options').queryParams.search_value = val;
                    $('#tab_select').datagrid('reload');
                },
                prompt: '请输入要查询的内容'
            });

            $("#ipt_search3").searchbox({
                width: 200,
                iconCls: 'icon-save',
                searcher: function (val, name) {
                    $('#tab_device').treegrid('options').queryParams.search_type = name;
                    $('#tab_device').treegrid('options').queryParams.search_value = val;
                    $('#tab_device').treegrid('reload');
                },
                prompt: '请输入要查询的内容'
            });

            $("#ipt_search4").searchbox({
                width: 200,
                iconCls: 'icon-save',
                searcher: function (val, name) {
                    $('#tab_person').datagrid('options').queryParams.search_type = name;
                    $('#tab_person').datagrid('options').queryParams.search_value = val;
                    $('#tab_person').datagrid('reload');
                },
                prompt: '请输入要查询的内容'
            });

            $("#ipt_search6").searchbox({
                width: 200,
                iconCls: 'icon-save',
                searcher: function (val, name) {
                    $('#tab_per').datagrid('options').queryParams.search_type = name;
                    $('#tab_per').datagrid('options').queryParams.search_value = val;
                    $('#tab_per').datagrid('reload');
                },
                prompt: '请输入要查询的内容'
            });

            $("#ipt_search7").searchbox({
                width: 200,
                iconCls: 'icon-save',
                searcher: function (val, name) {
                    $('#tab_employee').datagrid('options').queryParams.search_type = name;
                    $('#tab_employee').datagrid('options').queryParams.search_value = val;
                    $('#tab_employee').datagrid('reload');
                },
                prompt: '请输入要查询的内容'
            });

            var ssurl = window.location.href;
            var slen = ssurl.substr(0, ssurl.indexOf("&")).length;  //第一个&出现的位置
            if (slen > 0) {
                var s = get_url(ssurl);
                var len = s.substr(0, s.indexOf("&")).length;  //第一个&出现的位置
                var sstr = s.substr(len + 1, s.length - len);

                if (sstr == "" || sstr == null || sstr == undefined || sstr.length == 0) {
                    searchVal();
                }
                else {

                    //$('#tab').datagrid('load', { "action": "query", sb: sstr, qsrq: qsrq, jzrq: jzrq, state: "s" });

                    $('#tab').datagrid('load', { "action": "query", sb: sstr, state: "s" });
                }
            }
            else {
                //使用url动态加载
                //$('#tab').datagrid({ url: 'wxjl.ashx', queryParams: { "action": "query", state: "s"} });

                searchVal();
            }
        })
        /////////////////////////删除/////////////////
        function delete_dg() {
            //获取url
            var surl = get_url();
            $.post("qx_load.ashx", { "action": "add", data: surl }, function (data) {
                if (data == "del") {
                    $.messager.alert("提示", "您没有操作此功能的权限，请与系统管理员联系！");
                    return;
                }

                var selected = $("#tab").datagrid('getSelected');
                if (selected != null) {
                    $.messager.confirm('提示', '是否确定要删除？', function (y) {
                        if (y) {
                            var v = "";
                            var checked = $("#tab").datagrid('getChecked');
                            $.each(checked, function (i, j) {
                                v += j.JSON_id + ",";
                            })
                            v = v.substring(0, v.length - 1);
                            $.post("wxjl.ashx", { "action": "del", id: v }, function (data) {
                                $.messager.alert('提示', data);
                                $("#tab").datagrid('reload');
                            });
                        }
                    })
                } else {
                    $.messager.alert('提示', '您还没有选中一行数，请选中在删除！');
                }
            });
        }

        /////////////////////添加///////////////////
        function add_dg() {
            //获取url
            var surl = get_url();
            $.post("qx_load.ashx", { "action": "add", data: surl }, function (data) {
                if (data == "add") {
                    $.messager.alert("提示", "您没有操作此功能的权限，请与系统管理员联系！");
                    return;
                }

                //表单清空
                $("#fm_dg")[0].reset();
                //清空明细表格数据，没有该语句会显示上次记录
                $('#tab2').datagrid('loadData', { total: 0, rows: [] });
                //显示
                $("#dd_dg").show();

                var flag = "";      //明细标志

                var myDate = new Date();
                var parm = myDate.toLocaleDateString();
                parm = parm + "&WX"
                var pp = decodeURIComponent(parm, true);
                //自动生成工单号
                $.post("scgdh.ashx", { data: pp }, function (data) {
                    $('#cgdh').val(data);
                });

                //获取操作员
                $.post("getSession.ashx", function (data) {
                    $('#cczy').val(data);
                });

                //使用服务器函数返回日期
                $.post("getDate.ashx", { data: myDate.toLocaleDateString() }, function (data) {
                    $('#drq').datebox('setValue', data);
                });

                var curtime = getCurTime();

                //使用服务器函数返回日期
                $.post("getDate.ashx", { data: curtime }, function (data) {
                    $('#dgzsj').datetimebox('setValue', data);
                    $('#dwxkssj').datetimebox('setValue', data);
                    $('#dwcsj').datetimebox('setValue', data);
                });

                //以窗体的形式展示
                $("#dd_dg").dialog({
                    title: "添加维修记录", //标题
                    iconCls: "icon-add", //图标
                    width: 900, //窗体的宽度
                    height: 500, //窗体的高度
                    modal: true, //遮罩层
                    //按钮集合
                    buttons: [
                    {
                        text: "转单保存", //添加按钮的文本值
                        iconCls: "icon-ok", //添加按钮的图标
                        handler: function () {
                            var sDate = $("#drq").datebox("getValue");
                            var d_sbbh = $("#csbbh").val();
                            var d_sbmc = $("#csbmc").val();
                            var d_scx = $('#cscx').val();
                            var d_zy = $('#czy').val();
                            var d_cczy = $('#cczy').val();


                            //将数据序列化
                            var parm = $("#fm_dg").serialize();

                            //备件
                            //----------------------------------------------------------
                            if (editIndex != undefined || editIndex != null) {
                                $('#tab2').datagrid('endEdit', editIndex);
                            }
                            var rows = $('#tab2').datagrid('getData');

                            //                            if (rows.total < 1) {
                            //                                $.messager.alert("提示", "备件更换记录行数不允许没空，请添加！");
                            //                                return;
                            //                            }

                            var parms = "*";     //该处不能使用#，否则出错，可能#为jquery的默认关键字。
                            var DeviceId = "";      //备件编号
                            var Quantity = 0;       //明细

                            if (rows.total >= 1) {
                                for (var i = 0; i <= rows.total - 1; i++) {
                                    selected = $('#tab2').datagrid('getRows')[i];
                                    DeviceId = selected.JSON_cbjbh;
                                    Quantity = selected.JSON_ibjsl;

                                    parms = parms + "&" + DeviceId + "&" + Quantity + "@";
                                }
                            }
                            else {
                                parms = parms + 0 + "@";
                            }

                            parms = parms.substr(0, parms.length - 1);     //去掉最后的@
                            parms = parms + "*" + rows.total;

                            parm = parm + "~" + parms;
                            //----------------------------------------------------------

                            //中文格式转换
                            var pp = decodeURIComponent(parm, true);

                            //post异步提交
                            $.post("wxjl.ashx", { "action": "add2", data: pp }, function (data) {
                                flag = data.substr(0, 1);

                                if (data == "1") {
                                    $.messager.alert('提示', "该工单号已存在，请重新输入！");
                                    return;
                                }

                                if (data == "2") {
                                    $.messager.alert('提示', "设备不允许为空！");
                                    return;
                                }

                                if (data == "3") {
                                    $.messager.alert('提示', "该设备不存在，请重新输入！");
                                    return;
                                }

                                if (flag == "4") {
                                    $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件编号不允许为空，请选择！");
                                    return;
                                }
                                if (flag == "5") {
                                    $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件不存在，请重新选择！");
                                    return;
                                }
                                if (flag == "6") {
                                    $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行使用数量不允许为空，请重新输入！");
                                    return;
                                }

                                //添加待办事项
                                //----------------------------------------------------------------
                                //表单清空
                                $("#fm_db")[0].reset();

                                //显示
                                $("#div_db").show();

                                $("#d_drq").datebox("setValue", sDate)
                                $("#d_csbbh").val(d_sbbh);
                                $("#d_csbmc").val(d_sbmc);
                                $('#d_cscx').val(d_scx);
                                $('#d_czy').val(d_zy);
                                $('#d_cczy').val(d_cczy);
                                $("#d_csxlx").combobox("select", "维修");
                                $("#d_czt").combobox("select", "持续中");


                                //以窗体的形式展示
                                $("#div_db").dialog({
                                    title: "添加待办事项", //标题
                                    iconCls: "icon-add", //图标
                                    width: 550, //窗体的宽度
                                    height: 350, //窗体的高度
                                    modal: true, //遮罩层
                                    //按钮集合
                                    buttons: [
                                    {
                                        text: "保存", //添加按钮的文本值
                                        iconCls: "icon-ok", //添加按钮的图标
                                        handler: function () {
                                            //将数据序列化
                                            var parm = $("#fm_db").serialize();
                                            //中文格式转换
                                            var pp = decodeURIComponent(parm, true);
                                            //post异步提交
                                            $.post("dbsx.ashx", { "action": "add", data: pp }, function (data) {
                                                if (data == "1") {
                                                    $.messager.alert("提示", "备件编号不允许为空！");
                                                    return;
                                                }
                                                if (data == "2") {
                                                    $.messager.alert("提示", "该备件编号不存在！");
                                                    return;
                                                }

                                                $.messager.alert('提示', "待办事项" + data);
                                                //关闭
                                                $("#div_db").window('close');

                                                $.messager.alert('提示', "维修记录" + data);
                                                //重新加载datagrid
                                                $("#tab").datagrid('reload');
                                                $("#dd_dg").window('close');
                                            });
                                        }
                                    },
                                        {
                                            text: "取消",
                                            iconCls: "icon-cancel",
                                            handler: function () {
                                                $("#div_db").window("close");

                                                $.messager.alert('提示', "维修记录" + data);
                                                //重新加载datagrid
                                                $("#tab").datagrid('reload');
                                                $("#dd_dg").window('close');
                                            }
                                        }
                                    ]
                                });
                                //-----------------------------------------------------------------


                            });
                        }
                    },
            {
                text: "保存", //添加按钮的文本值
                iconCls: "icon-ok", //添加按钮的图标
                handler: function () {
                    //将数据序列化
                    var parm = $("#fm_dg").serialize();

                    //备件
                    //----------------------------------------------------------
                    if (editIndex != undefined || editIndex != null) {
                        $('#tab2').datagrid('endEdit', editIndex);
                    }
                    var rows = $('#tab2').datagrid('getData');

                    //                    if (rows.total < 1) {
                    //                        $.messager.alert("提示", "备件更换记录行数不允许没空，请添加！");
                    //                        return;
                    //                    }

                    var parms = "*";     //该处不能使用#，否则出错，可能#为jquery的默认关键字。
                    var DeviceId = "";      //备件编号
                    var Quantity = 0;       //明细

                    if (rows.total >= 1) {
                        for (var i = 0; i <= rows.total - 1; i++) {
                            selected = $('#tab2').datagrid('getRows')[i];
                            DeviceId = selected.JSON_cbjbh;
                            Quantity = selected.JSON_ibjsl;

                            parms = parms + "&" + DeviceId + "&" + Quantity + "@";
                        }
                    }
                    else {
                        parms = parms + 0 + "@";
                    }

                    parms = parms.substr(0, parms.length - 1);     //去掉最后的@
                    parms = parms + "*" + rows.total;

                    parm = parm + "~" + parms;
                    //----------------------------------------------------------

                    //中文格式转换
                    var pp = decodeURIComponent(parm, true);

                    //post异步提交
                    $.post("wxjl.ashx", { "action": "add", data: pp }, function (data) {
                        flag = data.substr(0, 1);

                        if (data == "1") {
                            $.messager.alert('提示', "该工单号已存在，请重新输入！");
                            return;
                        }

                        if (data == "2") {
                            $.messager.alert('提示', "设备不允许为空！");
                            return;
                        }

                        if (data == "3") {
                            $.messager.alert('提示', "该设备不存在，请重新输入！");
                            return;
                        }

                        if (data == "9") {
                            $.messager.alert('提示', "作业人不允许为空，请重新选择！");
                            return;
                        }

                        if (flag == "4") {
                            $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件编号不允许为空，请选择！");
                            return;
                        }
                        if (flag == "5") {
                            $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件不存在，请重新选择！");
                            return;
                        }
                        if (flag == "6") {
                            $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行使用数量不允许为空，请重新输入！");
                            return;
                        }


                        $.messager.alert('提示', data);
                        //重新加载datagrid
                        $("#tab").datagrid('reload');
                        //关闭
                        $("#dd_dg").window('close');

                    });
                }
            },
              {
                  text: "取消",
                  iconCls: "icon-cancel",
                  handler: function () {
                      $("#dd_dg").window("close");
                  }
              }
            ]
                });
            });
        }

        //////////////////修改//////////////////
        function edit_dg() {
            //获取url
            var surl = get_url();
            $.post("qx_load.ashx", { "action": "edit", data: surl }, function (data) {
                if (data == "edit") {
                    $.messager.alert("提示", "您没有操作此功能的权限，请与系统管理员联系！");
                    return;
                }

                //选中一行，获取这一行的属性的值
                var selected = $("#tab").datagrid('getSelected');
                //判断是否选中
                if (selected != null) {
                    $('#drq').datebox('setValue', myformatter(selected.JSON_drq));
                    $('#cscx').val(selected.JSON_cscx);
                    $('#czy').val(selected.JSON_czy);
                    $('#dgzsj').datetimebox('setValue',selected.JSON_dgzsj);
                    $('#dwxkssj').datetimebox('setValue', selected.JSON_dwxkssj);
                    $('#dwcsj').datetimebox('setValue', selected.JSON_dwcsj);
                    

                    $('#cgzlx').combotree("setValue", selected.JSON_igzlx);
                    $('#cclfs').val(selected.JSON_cclfs);

                    $("#id").val(selected.JSON_id);
                    $('#cwxr').val(selected.JSON_cwxr);
                    $("#cgdh").val(selected.JSON_cgdh);
                    $("#csbbh").val(selected.JSON_csbbh);
                    $("#csbmc").val(selected.JSON_csbmc);
                    $("#cgzxx").val(selected.JSON_cgzxx);
                    $("#cwxnr").val(selected.JSON_cwxnr);
                    $("#cczy").val(selected.JSON_cczy);
                    $("#cfzry").val(selected.JSON_cfzry);
                    $("#cbz").val(selected.JSON_cbz);

                    var flag = "";

                    var wxid = selected.JSON_id;
                    $('#tab2').datagrid('load', { "action": "query", wxid: wxid });

                    $("#dd_dg").show(); //显示修改窗体

                    $("#dd_dg").dialog({
                        title: "编辑维修记录",
                        iconCls: "icon-edit",
                        modal: true, //遮罩层
                        width: 900,
                        height: 500,
                        buttons: [
                        {
//                            text: "转单保存",
//                            iconCls: "icon-save",
//                            handler: function () {
//                                var parm = $("#fm_dg").serialize();
//                                //备件
//                                //----------------------------------------------------------
//                                if (editIndex != undefined || editIndex != null) {
//                                    $('#tab2').datagrid('endEdit', editIndex);
//                                }
//                                var rows = $('#tab2').datagrid('getData');

//                                //                                if (rows.total < 1) {
//                                //                                    $.messager.alert("提示", "备件更换记录行数不允许没空，请添加！");
//                                //                                    return;
//                                //                                }

//                                var parms = "*";     //该处不能使用#，否则出错，可能#为jquery的默认关键字。
//                                var DeviceId = "";      //备件编号
//                                var Quantity = 0;       //明细

//                                if (rows.total >= 1) {
//                                    for (var i = 0; i <= rows.total - 1; i++) {
//                                        selected = $('#tab2').datagrid('getRows')[i];
//                                        DeviceId = selected.JSON_cbjbh;
//                                        Quantity = selected.JSON_ibjsl;

//                                        parms = parms + "&" + DeviceId + "&" + Quantity + "@";
//                                    }
//                                }
//                                else {
//                                    parms = parms + 0 + "@";
//                                }

//                                parms = parms.substr(0, parms.length - 1);     //去掉最后的@
//                                parms = parms + "*" + rows.total;

//                                parm = parm + "~" + parms;
//                                //----------------------------------------------------------

//                                //中文格式转换
//                                var pp = decodeURIComponent(parm, true);

//                                $.post("wxjl.ashx", { "action": "edit2", data: pp }, function (data) {
//                                    flag = data.substr(0, 1);

//                                    if (data == "7") {
//                                        $.messager.alert('提示', "待办事项中已插入该记录，无需重复插入！");
//                                        return;
//                                    }

//                                    if (data == "1") {
//                                        $.messager.alert('提示', "该工单号已存在，请重新输入！");
//                                        return;
//                                    }

//                                    if (data == "2") {
//                                        $.messager.alert('提示', "设备不允许为空！");
//                                        return;
//                                    }

//                                    if (data == "3") {
//                                        $.messager.alert('提示', "该设备不存在，请重新输入！");
//                                        return;
//                                    }

//                                    if (data == "9") {
//                                        $.messager.alert('提示', "作业人不允许为空，请重新选择！");
//                                        return;
//                                    }

//                                    if (flag == "4") {
//                                        $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件编号不允许为空，请选择！");
//                                        return;
//                                    }
//                                    if (flag == "5") {
//                                        $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件不存在，请重新选择！");
//                                        return;
//                                    }
//                                    if (flag == "6") {
//                                        $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行使用数量不允许为空，请重新输入！");
//                                        return;
//                                    }

//                                    $.messager.alert('提示', data);
//                                    //重新加载datagrid
//                                    $("#tab").datagrid('reload');
//                                    //关闭
//                                    $("#dd_dg").window('close');
//                                });
//                            }
//                        },
//                  {
                      text: "保存",
                      iconCls: "icon-edit",
                      handler: function () {
                          var parm = $("#fm_dg").serialize();
                          //备件
                          //----------------------------------------------------------
                          if (editIndex != undefined || editIndex != null) {
                              $('#tab2').datagrid('endEdit', editIndex);
                          }
                          var rows = $('#tab2').datagrid('getData');

                          //                          if (rows.total < 1) {
                          //                              $.messager.alert("提示", "备件更换记录行数不允许没空，请添加！");
                          //                              return;
                          //                          }

                          var parms = "*";     //该处不能使用#，否则出错，可能#为jquery的默认关键字。
                          var DeviceId = "";      //备件编号
                          var Quantity = 0;       //明细

                          if (rows.total >= 1) {
                              for (var i = 0; i <= rows.total - 1; i++) {
                                  selected = $('#tab2').datagrid('getRows')[i];
                                  DeviceId = selected.JSON_cbjbh;
                                  Quantity = selected.JSON_ibjsl;

                                  parms = parms + "&" + DeviceId + "&" + Quantity + "@";
                              }
                          }
                          else {
                              parms = parms + 0 + "@";
                          }

                          parms = parms.substr(0, parms.length - 1);     //去掉最后的@
                          parms = parms + "*" + rows.total;

                          parm = parm + "~" + parms;
                          //----------------------------------------------------------

                          //中文格式转换
                          var pp = decodeURIComponent(parm, true);

                          $.post("wxjl.ashx", { "action": "edit", data: pp }, function (data) {
                              flag = data.substr(0, 1);

                              if (data == "1") {
                                  $.messager.alert('提示', "该工单号已存在，请重新输入！");
                                  return;
                              }

                              if (data == "2") {
                                  $.messager.alert('提示', "设备不允许为空！");
                                  return;
                              }

                              if (data == "3") {
                                  $.messager.alert('提示', "该设备不存在，请重新输入！");
                                  return;
                              }

                              if (data == "9") {
                                  $.messager.alert('提示', "作业人不允许为空，请重新选择！");
                                  return;
                              }

                              if (flag == "4") {
                                  $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件编号不允许为空，请选择！");
                                  return;
                              }
                              if (flag == "5") {
                                  $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行备件不存在，请重新选择！");
                                  return;
                              }
                              if (flag == "6") {
                                  $.messager.alert("提示", "第" + data.substr(2, data.length - 2) + "行使用数量不允许为空，请重新输入！");
                                  return;
                              }

                              $.messager.alert('提示', data);
                              //重新加载datagrid
                              $("#tab").datagrid('reload');
                              //关闭
                              $("#dd_dg").window('close');

                          });
                      }

                  },
                    {
                        text: "取消",
                        iconCls: "icon-cancel",
                        handler: function () {
                            $("#dd_dg").window('close');
                        }
                    }
                  ]


                    });
                } else {
                    $.messager.alert('提示', '请选中一行在进行编辑');
                }
            });
        }

        function sec() {
            //设备编号
            var csbbh = document.getElementById("csbbh").value;

            if (csbbh == "" || csbbh == null) {
                $.messager.alert("提示", "设备编号不允许为空，请输入！");
                return;
            }

            var pp = decodeURIComponent(csbbh, true);

            $.post("sb_load.ashx", { data: pp }, function (data) {
                if (data == "") {
                    $.messager.alert("提示", "无法查找该设备，请重新输入！");
                    return;
                }

                var len = data.substr(0, data.indexOf("&")).length;  //&出现的位置
                var llen = data.substr(0, data.indexOf(",")).length;  //,出现的位置
                var sbmc = data.substr(0, len);
                var scx = data.substr(len + 1, llen - len - 1);
                var csszy = data.substr(llen + 1, data.length - llen);
                $("#csbmc").val(sbmc);
                $("#cscx").val(scx);
                $("#czy").val(csszy);
            });
        }

        var editIndex = undefined;
        var sflag = "";

        /////////////////////添加///////////////////
        function add_mx() {
            if (sflag == "add" || sflag=="edit") {
                $('#tab2').datagrid('endEdit', editIndex);

                //设置选定行，否则无法获取内容
                $('#tab2').datagrid('selectRow', editIndex);

                sflag = "";
            }

            $('#tab2').datagrid('appendRow', {});
            editIndex = $('#tab2').datagrid('getRows').length - 1;
            $('#tab2').datagrid('selectRow', editIndex)
			.datagrid('beginEdit', editIndex);

            sflag = "add";
        }

        //////////////////修改//////////////////
        function edit_mx() {
            var selected = $("#tab2").datagrid('getSelected');

            //不是同一行，结束编辑状态
            if (editIndex != selected) {
                $('#tab2').datagrid('endEdit', editIndex);
            }

            //重新获取行索引
            editIndex = $('#tab2').datagrid('getRowIndex', selected);

            $('#tab2').datagrid('selectRow', editIndex)
                .datagrid('beginEdit', editIndex);
            sflag = "edit";
        }

        /////////删除////////////////////////
        function delete_mx() {
            var selected = $("#tab2").datagrid('getSelected');

            editIndex = $('#tab2').datagrid('getRowIndex', selected);
            
            if (selected != null) {
                    $.messager.confirm('提示', '是否确定要删除？', function (y) {
                        if (y) {
                            if (editIndex == undefined) { return }
                            $('#tab2').datagrid('cancelEdit', editIndex)
					                .datagrid('deleteRow', editIndex);
                            editIndex = undefined;
                        }
                    })
                } else {
                    $.messager.alert('提示', '您还没有选中一行数，请选中在删除！');
                }
            }

            //查询
            function searchVal() {
                var qsrq = $('#dqsrq').datebox('getValue');
                var jzrq = $('#djzrq').datebox('getValue');

                var ckey = $('#sel_key').combobox('getValue');
                var cmemo = $('#cmemo').val();

                $('#tab').datagrid({ url: 'wxjl.ashx', queryParams: { "action": "query", qsrq: qsrq, jzrq: jzrq, ckey: ckey, cmemo: cmemo, state: "s"} });
            }


            /**  
            * 扩展两个方法  
            */
            $.extend($.fn.datagrid.methods, {
                /**
                * 开打提示功能  
                * @param {} jq  
                * @param {} params 提示消息框的样式  
                * @return {}  
                */
                doCellTip: function (jq, params) {
                    function showTip(data, td, e) {
                        if ($(td).text() == "")
                            return;
                        data.tooltip.text($(td).text()).css({
                            top: (e.pageY + 10) + 'px',
                            left: (e.pageX + 20) + 'px',
                            'z-index': $.fn.window.defaults.zIndex,
                            display: 'block'
                        });
                    };
                    return jq.each(function () {
                        var grid = $(this);
                        var options = $(this).data('datagrid');
                        if (!options.tooltip) {
                            var panel = grid.datagrid('getPanel').panel('panel');
                            var defaultCls = {
                                'border': '1px solid #333',
                                'padding': '1px',
                                'color': '#333',
                                'background': '#f7f5d1',
                                'position': 'absolute',
                                'max-width': '200px',
                                'border-radius': '4px',
                                '-moz-border-radius': '4px',
                                '-webkit-border-radius': '4px',
                                'display': 'none'
                            }
                            var tooltip = $("<div id='celltip'></div>").appendTo('body');
                            tooltip.css($.extend({}, defaultCls, params.cls));
                            options.tooltip = tooltip;
                            panel.find('.datagrid-body').each(function () {
                                var delegateEle = $(this).find('> div.datagrid-body-inner').length
                                ? $(this).find('> div.datagrid-body-inner')[0]
                                : this;
                                $(delegateEle).undelegate('td', 'mouseover').undelegate(
                                'td', 'mouseout').undelegate('td', 'mousemove')
                                .delegate('td', {
                                    'mouseover': function (e) {
                                        if (params.delay) {
                                            if (options.tipDelayTime)
                                                clearTimeout(options.tipDelayTime);
                                            var that = this;
                                            options.tipDelayTime = setTimeout(
                                                    function () {
                                                        showTip(options, that, e);
                                                    }, params.delay);
                                        } else {
                                            showTip(options, this, e);
                                        }

                                    },
                                    'mouseout': function (e) {
                                        if (options.tipDelayTime)
                                            clearTimeout(options.tipDelayTime);
                                        options.tooltip.css({
                                            'display': 'none'
                                        });
                                    },
                                    'mousemove': function (e) {
                                        var that = this;
                                        if (options.tipDelayTime) {
                                            clearTimeout(options.tipDelayTime);
                                            options.tipDelayTime = setTimeout(
                                                    function () {
                                                        showTip(options, that, e);
                                                    }, params.delay);
                                        } else {
                                            showTip(options, that, e);
                                        }
                                    }
                                });
                            });

                        }

                    });
                },
                /**
                * 关闭消息提示功能  
                * @param {} jq  
                * @return {}  
                */
                cancelCellTip: function (jq) {
                    return jq.each(function () {
                        var data = $(this).data('datagrid');
                        if (data.tooltip) {
                            data.tooltip.remove();
                            data.tooltip = null;
                            var panel = $(this).datagrid('getPanel').panel('panel');
                            panel.find('.datagrid-body').undelegate('td',
                                    'mouseover').undelegate('td', 'mouseout')
                                    .undelegate('td', 'mousemove')
                        }
                        if (data.tipDelayTime) {
                            clearTimeout(data.tipDelayTime);
                            data.tipDelayTime = null;
                        }
                    });
                }
            });

    </script>
</head>
<body style="width:100%;height:100%;margin:0;padding:0;overflow:hidden" class="easyui-layout">
<div  id="wrap" class="easyui-layout" style="width:100%;height:100%;">
<div id="panel1" data-options="region:'west',split:true", title="设备资料" style="width:200px;">
<ul id="tt"></ul> 
</div>
<div id="panel2" data-options="region:'center',title:'维修记录',iconCls:'icon-ok',border:false" class="div01">
<table id="tab">
</table>
</div>
</div>
<div id="tool">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
       		<td style=" padding-left:2px">
                <a href="#" class="easyui-linkbutton" id="id_add" iconcls="icon-add"  plain="true" onclick="add_dg();" >添加</a>
                <a href="#" class="easyui-linkbutton" id="id_edit" iconCls="icon-edit"  plain="true" onclick="edit_dg();">修改</a>
                <a href="#" class="easyui-linkbutton" id="id_cancel" onclick="delete_dg();"  iconcls="icon-cancel" plain="true">删除</a>
                <a href="#" class="easyui-linkbutton" onclick="return Save_Excel()" iconCls="icon-save" plain="true" title="导出">导出</a>
            </td>
        </tr>
         <tr>
            <td style="text-align: left; ">
            <div id="searchRq">
                日期: <input id="dqsrq" name="dqsrq" class="easyui-datebox"  style="width:100px;" editable="false"/>
			    至 <input id="djzrq" name="djzrq" class="easyui-datebox"   style="width:100px;"  editable="false"/> 
                <select style="width:135px;" id="sel_key" name="sel_key" class="easyui-combobox" >
                    <option value="工单号">工单号</option>
                    <option value="设备编号">设备编号</option>
                    <option value="设备名称">设备名称</option>
                    <option value="生产线">生产线</option>
                    <option value="专业">专业</option>
                    <option value="故障类型">故障类型</option>
                    <option value="故障现象">故障现象</option>
                    <option value="处理方式">处理方式</option>
                    <option value="作业人">作业人</option>
                    <option value="辅助人员">辅助人员</option>
                    <option value="制单人">制单人</option>
                    <option value="维修内容">维修内容</option>
                    <option value="备注">备注</option>
                  </select>
                  <input id="cmemo" name="cmemo" class="easyui-validatebox"  style="width:150px;"/>
                <a href="#" class="easyui-linkbutton"  iconCls="icon-search"  onclick="searchVal();">查询</a>
            </div>
            </td>     
       	</tr>
       </table>
    </div>
    <br />

    <div id="tool2">
       <table border="0" cellspacing="l0" cellpadding="0" width="100%">
       	<tr>
       		<td style=" padding-left:2px">
                <a href="#" class="easyui-linkbutton" id="add" iconcls="icon-add"  plain="true" onclick="add_mx();" >添加</a>
                <a href="#" class="easyui-linkbutton" id="edit" iconCls="icon-edit"  plain="true" onclick="edit_mx();">修改</a>
                <a href="#" class="easyui-linkbutton" id="delete" onclick="delete_mx();"  iconcls="icon-cancel" plain="true">删除</a>
            </td>
        </tr>
       </table>
    </div>
       </br>
   <div id="tool_select">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
            <td style="text-align: right; padding-right: 15px">
                    <input id="ipt_search2" menu="#search_menu2" />
                    <div id="search_menu2" style="width:120px">
                        <div name="cbjbh">
                            备件编号</div>
                        <div name="cbjmc">
                            备件名称</div>
                        <div name="cggxh">
                            规格型号</div>
                        <div name="cjscs">
                            技术参数</div>
                        <div name="cbjdj">
                            备件等级</div>
                        <div name="csszy">
                            所属专业</div>
                        <div name="csccj">
                            生产厂家</div>
                          <div name="ibjsl">
                            备件数量</div>
                        <div name="csysb">
                            适用设备</div>
                        <div name="cbz">
                            备注</div>
                    </div>
                </td>
       	</tr>
       </table>
    </div>
    </br>
    <div id="tool_device">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
            <td style=" padding-left:2px">
                <a href="#" class="easyui-linkbutton" id="id_search" onclick="search_dg();"  iconcls="icon-search" plain="true">高级查询</a>
            </td>
            <td style="text-align: right; padding-right: 15px">
                    <input id="ipt_search3" menu="#search_menu3" />
                    <div id="search_menu3" style="width:120px">
                        <div name="csbfl">
                            设备分类</div>
                        <div name="csbbh">
                            设备编号</div>
                        <div name="csbmc">
                            设备名称</div>
                        <div name="csbsbh">
                            RFID码</div>
                        <div name="cscx">
                            生产线</div>
                        <div name="csszy">
                            所属专业</div>
                        <div name="csdwz">
                            上端位置</div>
                        <div name="csbxh">
                            设备型号</div>
                        <div name="cjscs">
                            技术参数</div>
                        <div name="csccj">
                            生产厂家</div>
                        <div name="izjsl">
                            装机数量</div>
                        <div name="cazdd">
                            安装地点</div>
                        <div name="csbdj">
                            设备等级</div>
                        <div name="csbzt">
                            设备状态</div>
                        <div name="cbz">
                            备注</div>
                    </div>
                </td>
       	</tr>
       </table>
    </div>
    <br />
    <div id="tool_person">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
            <td style="text-align: right; padding-right: 15px">
                    <input id="ipt_search4" menu="#search_menu4" />
                    <div id="search_menu4" style="width:120px">
                        <div name="cygbh">
                            员工编号</div>
                        <div name="cygxm">
                            员工姓名</div>
                        <div name="cbmmc">
                            部门名称</div>
                        <div name="czw">
                            职位</div>
                        <div name="cxb">
                            性别</div>
                          <div name="cnl">
                            年龄</div>
                        <div name="drzsj">
                            入职时间</div>
                        <div name="cbyyx">
                            毕业院校</div>
                        <div name="czy">
                            专业</div>
                        <div name="csfzh">
                            身份证号</div>
                        <div name="clxdh">
                            联系电话</div>
                        <div name="cjjlxr">
                            紧急联系人</div>
                        <div name="cjjlxrdh">
                            紧急联系人电话</div>
                        <div name="cczyf">
                            操作员否</div>
                        <div name="cwxh">
                            微信号</div>
                        <div name="czt">
                            状态</div>
                        <div name="cbz">
                            备注</div>
                    </div>
                </td>
       	</tr>
       </table>
    </div>
    <br />
    <div id="tool_per">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
            <td style="text-align: right; padding-right: 15px">
                    <input id="ipt_search6" menu="#search_menu6" />
                    <div id="search_menu6" style="width:120px">
                        <div name="cygbh">
                            员工编号</div>
                        <div name="cygxm">
                            员工姓名</div>
                        <div name="cbmmc">
                            部门名称</div>
                        <div name="czw">
                            职位</div>
                        <div name="cxb">
                            性别</div>
                          <div name="cnl">
                            年龄</div>
                        <div name="drzsj">
                            入职时间</div>
                        <div name="cbyyx">
                            毕业院校</div>
                        <div name="czy">
                            专业</div>
                        <div name="csfzh">
                            身份证号</div>
                        <div name="clxdh">
                            联系电话</div>
                        <div name="cjjlxr">
                            紧急联系人</div>
                        <div name="cjjlxrdh">
                            紧急联系人电话</div>
                        <div name="cczyf">
                            操作员否</div>
                        <div name="cwxh">
                            微信号</div>
                        <div name="czt">
                            状态</div>
                        <div name="cbz">
                            备注</div>
                    </div>
                </td>
       	</tr>
       </table>
    </div>
    <br />
    <div id="tool_employee">
       <table border="0" cellspacing="0" cellpadding="0" width="100%">
       	<tr>
            <td style="text-align: right; padding-right: 15px">
                    <input id="ipt_search7" menu="#search_menu7" />
                    <div id="search_menu7" style="width:120px">
                        <div name="cygbh">
                            员工编号</div>
                        <div name="cygxm">
                            员工姓名</div>
                        <div name="cbmmc">
                            部门名称</div>
                        <div name="czw">
                            职位</div>
                        <div name="cxb">
                            性别</div>
                          <div name="cnl">
                            年龄</div>
                        <div name="drzsj">
                            入职时间</div>
                        <div name="cbyyx">
                            毕业院校</div>
                        <div name="czy">
                            专业</div>
                        <div name="csfzh">
                            身份证号</div>
                        <div name="clxdh">
                            联系电话</div>
                        <div name="cjjlxr">
                            紧急联系人</div>
                        <div name="cjjlxrdh">
                            紧急联系人电话</div>
                        <div name="cczyf">
                            操作员否</div>
                        <div name="cwxh">
                            微信号</div>
                        <div name="czt">
                            状态</div>
                        <div name="cbz">
                            备注</div>
                    </div>
                </td>
       	</tr>
       </table>
    </div>
    <br />
   <div id="dd_dg" style=" display:none">
        <form id="fm_dg">
        <input type="hidden" align="center" id="id" name="id"/>

<table width="830" height="150" border="0" align="center">
  <tr>
    <td width="65" height="31"><div align="right">工单号:</div></td>
    <td width="190"><input style="width:145px;" id="cgdh" name="cgdh" class="easyui-validatebox"  readonly/></td>
    <td width="104" height="31"><div align="right">日期:</div></td>
    <td width="167"><input style="width:145px;" id="drq" name="drq" class="easyui-datebox"  editable="false"/></td>
    <td width="86" height="31"><div align="right">设备编号:</div></td>
    <td width="192"><input style="width:145px;" type="text" id="csbbh" name="csbbh" class="easyui-validatebox"   onkeyup="if (event.keyCode==13) {sec();}" readonly/>
    <a href="#" class="easyui-linkbutton" id="search" iconcls="icon-search"  plain="true" onclick="selectDevice();" ></a></td>
  </tr>
  <tr>
    <td width="65" height="31"><div align="right">设备名称:</div></td>
    <td width="190"><input style="width:145px;" type="text" id="csbmc" name="csbmc" class="easyui-validatebox"  readonly/></td>
    <td width="104" height="30"><div align="right">生产线:</div></td>
    <td width="167"><input style="width:145px;" type="text" id="cscx" name="cscx" class="easyui-validatebox" readonly /></td>
    <td width="86" height="30"><div align="right">专业:</div></td>
    <td width="192"><input style="width:145px;" type="text" id="czy" name="czy" class="easyui-validatebox" readonly /></td>
  </tr>
  <tr>
    <td width="65" height="31"><div align="right">故障时间:</div></td>
    <td width="190"><input  style="width:145px;" id="dgzsj" name="dgzsj" class="easyui-datetimebox"  editable="false"/></td>
    <td width="104" height="31"><div align="right">故障类型:</div></td>
    <td width="167"><input style="width:145px;" id="cgzlx" name="cgzlx" class="easyui-combotree"/></td>

     <td height="41"><div align="right">作业人:</div></td>
    <td><input style="width:145px;" id="cwxr" name="cwxr" class="easyui-validatebox" readonly />
     <a href="#" class="easyui-linkbutton" id="searchPerson" iconcls="icon-search"  plain="true" onclick="selectPerson();" ></a></td>
 </tr>
   <tr>
    <td width="104" height="31"><div align="right">维修开始时间:</div></td>
    <td width="167"><input style="width:145px;" id="dwxkssj" name="dwxkssj" class="easyui-datetimebox"  editable="false"/></td>
    <td width="86" height="31"><div align="right">完成时间:</div></td>
    <td width="192"><input style="width:145px;" id="dwcsj" name="dwcsj" class="easyui-datetimebox"  editable="false"/></td>

    <td height="41"><div align="right">制单人:</div></td>
    <td><input style="width:145px;" id="cczy" name="cczy" class="easyui-validatebox" readonly />
 </tr>
 <tr >
  
     <td height="41"><div align="right">辅助人员:</div></td>
    <td colspan="5"><input style="width:710px;" id="cfzry" name="cfzry" class="easyui-validatebox" readonly />
     <a href="#" class="easyui-linkbutton" id="A1" iconcls="icon-search"  plain="true" onclick="selPerson();" ></a></td>
</tr>
<tr>
<td width="86" height="31"><div align="right">故障现象:</div></td>
<td colspan="5"><textarea style="width:710px;" id="cgzxx" name="cgzxx" class="easyui-validatebox" 
    onpaste="return false" oncontextmenu="return false" oncopy="return false" oncut="return false" onkeydown="checkEnter(event);" onkeypress="processSpelChar();"/></textarea></td>
</tr>
 <tr>
    <td width="65" height="31"><div align="right">处理方式:</div></td>
    <td colspan="5"><textarea style="width:710px;" type="text" id="cclfs" name="cclfs" class="easyui-validatebox" 
    onpaste="return false" oncontextmenu="return false" oncopy="return false" oncut="return false" onkeydown="checkEnter(event);" onkeypress="processSpelChar();"/></textarea></td>
 </tr>
 <tr>
    <td height="41"><div align="right">维修内容:</div></td>
    <td colspan="5"><textarea id="cwxnr" style="width:710px;" name="cwxnr" class="easyui-validatebox" 
    onpaste="return false" oncontextmenu="return false" oncopy="return false" oncut="return false" onkeydown="checkEnter(event);" onkeypress="processSpelChar();"/></textarea></td>
 </tr>
 <tr>
     <td height="41"><div align="right">备注:</div></td>
    <td colspan="5"><textarea id="cbz" style="width:710px;" name="cbz" class="easyui-validatebox" 
    onpaste="return false" oncontextmenu="return false" oncopy="return false" oncut="return false" onkeydown="checkEnter(event);" onkeypress="processSpelChar();"/></textarea></td>
  </tr>

</table>


        </form>

        <div align="center" width="830">
  <table width="800" border="0" id="tab2">
  </table>
</div>
    </div>

    <div id="div1" style=" display:none">
        <form id="form1">
    <div id="sele" align="center">
    <table id="tab_select">
</table>
</div>
</form>
</div>


<div id="div_db" style=" display:none">
        <form id="fm_db">
        <input type="hidden" id="d_id" name="d_id"/>
        <table border="0">
          <tr>
            <td width="145" height="31"><div align="right">设备编号:</div></td>
           <td width="200"><input type="text" style="width:130px;" id="d_csbbh" name="d_csbbh" class="easyui-validatebox"  
           onkeyup="value=value.replace(' ','')" onkeyup="if (event.keyCode==13) {sec();}" readonly/></td>

            <td width="145" height="31"><div align="right">设备名称:</div></td>
            <td width="200"><input style="width:130px;" type="text" id="d_csbmc" name="d_csbmc"   class="easyui-validatebox" readonly/></td>
          </tr>
          <tr>
            <td width="145" height="31"><div align="right">生产线:</div></td>
            <td width="200"><input style="width:130px;" type="text" id="d_cscx" name="d_cscx"  class="easyui-validatebox" readonly/></td>

            <td width="145" height="31"><div align="right">专业:</div></td>
            <td width="200"><input style="width:130px;" id="d_czy" name="d_czy" class="easyui-validatebox" readonly /></td>
          </tr>
          <tr>
            <td width="145" height="31"><div align="right">日期:</div></td>
            <td width="200"><input style="width:135px;" id="d_drq" name="d_drq" class="easyui-datebox" /></td>

             <td width="145" height="31"><div align="right">事项类型:</div></td>
            <td width="200"><input style="width:135px;" id="d_csxlx" name="d_csxlx" class="easyui-combobox" /></td>
          </tr>
          <tr>
            <td width="145" height="31"><div align="right">待办人:</div></td>
            <td width="200"><input style="width:130px;" id="d_cdbr" name="d_cdbr" class="easyui-validatebox" realonly/>
            <a href="#" class="easyui-linkbutton" id="selectPer" iconcls="icon-search"  plain="true" onclick="selemployee();" ></a></td>

             <td width="145" height="31"><div align="right">状态:</div></td>
            <td width="200"><select style="width:135px;" id="d_czt" name="d_czt" class="easyui-combobox" editable="false">
                    <option value="持续中">持续中</option>
                    <option value="关闭">关闭</option>
            </select></td>
          </tr>
          <tr>
            <td width="145" height="31"><div align="right">事项内容:</div></td>
            <td colspan="3"><input style="width:420px;" id="d_cczy" name="d_cczy" 
            onkeyup="value=value.replace(' ','')" class="easyui-validatebox" onkeypress="processSpelChar();" readonly/></td>
            </tr>
          <tr>
            <td width="145" height="31"><div align="right">事项内容:</div></td>
            <td colspan="3"><textarea style="width:420px;" id="d_csxnr" name="d_csxnr" 
            onkeyup="value=value.replace(' ','')" class="easyui-validatebox" onkeydown ="checkEnter(event);"  onkeypress="processSpelChar();"/></textarea></td>
            </tr>
          <tr>
            <td width="145" height="31"><div align="right">处理方式:</div></td>
            <td colspan="3"><textarea style="width:420px;" id="d_cclfs" name="d_cclfs" 
            onkeyup="value=value.replace(' ','')" class="easyui-validatebox"  onkeydown ="checkEnter(event);"   onkeypress="processSpelChar();"/></textarea></td>
           </tr>
          
</table>
        </form>
    </div>

<div id="div2" style=" display:none">
        <form id="form2">
    <div id="sel" align="center" >
    <table id="tab_device" class="easyui-treegrid"
			data-options="
				method: 'get',
				rownumbers: true,
				idField: 'id',
				treeField: 'csbmc',
                loadFilter: pagerFilter
			">
</table>
</div>
</form>
</div>

<div id="div4" style=" display:none">
        <form id="form4">
    <div id="div_person" align="center">
    <table id="tab_person">
</table>
</div>
</form>
</div>

<div id="div5" style=" display:none">
        <form id="form5">
    <div id="div_per" align="center">
    <table id="tab_per">
</table>
</div>
</form>
</div>

<div id="div6" style=" display:none">
        <form id="form6">
    <div id="div_employee" align="center">
    <table id="tab_employee">
</table>
</div>
</form>
</div>


<div id="div_search" align="center" style="display:none">
        <form id="fm_search">
        <table border="0">
          <tr>
            <td width="109" height="30"><div align="right">设备编号:</div></td>
            <td width="192"><input style="width:130px" type="text" id="s_csbbh" name="s_csbbh" class="easyui-validatebox"  /></td>
          
            <td height="30"><div align="right">设备名称:</div></td>
            <td><input type="text" style="width:130px" id="s_csbmc" name="s_csbmc" class="easyui-validatebox" /></td>
            </tr>
          <tr>
            <td height="30"><div align="right">RFID码:</div></td>
            <td><input type="text" style="width:130px" id="s_csbsbh" name="s_csbsbh" class="easyui-validatebox"  /></td>

            <td height="30"><div align="right">所属专业:</div></td>
            <td><input id="s_csszy" style="width:135px" name="s_csszy" class="easyui-combobox"></td>
          </tr>
          <tr>
            <td height="30"><div align="right">生产线:</div></td>
            <td><input id="s_cscx" style="width:135px" name="s_cscx" class="easyui-combobox"/></td>

            <td height="30"><div align="right">设备型号:</div></td>
            <td><input type="text" style="width:130px" id="s_csbxh" name="s_csbxh" class="easyui-validatebox" /></td>

          </tr>
          <tr>
            <td height="30"><div align="right">上端位置:</div></td>
            <td><input type="text" style="width:130px" id="s_csdwz" name="s_csdwz" class="easyui-validatebox" /></td>


            <td height="30"><div align="right">技术参数:</div></td>
            <td><input type="text" style="width:130px" id="s_cjscs" name="s_cjscs" class="easyui-validatebox"/></td>
           </tr>
           <tr>
            <td width="109" height="30"><div align="right">设备状态:</div></td>
            <td width="195"><input style="width:135px;" id="s_csbzt" name="s_csbzt" class="easyui-combobox" /></td>

            <td width="109" height="0"><div align="right">设备等级:</div></td>
            <td width="195"><input style="width:135px;" id="s_csbdj" name="s_csbdj" class="easyui-combobox" /></td>
          </tr>
          <tr>
            <td height="30"><div align="right">生产厂家:</div></td> 
            <td><input type="text" style="width:130px" id="s_csccj" name="s_csccj" class="easyui-validatebox" /></td>

            <td height="30"><div align="right">装机数量:</div></td>
            <td><input type="text" style="width:130px" id="s_izjsl" name="s_izjsl" class="easyui-numberbox" style="text-align:right"/></td>
          </tr>
          <tr>
            
            <td height="30"><div align="right">安装地点:</div></td>
            <td><input type="text" style="width:130px" id="s_cazdd" name="s_cazdd" class="easyui-validatebox"  /></td>

            <td height="30"><div align="right">备注:</div></td>
            <td ><input type="text" style="width:130px" id="s_cbz" name="s_cbz" class="easyui-validatebox"/></td>
          </tr>

        </table>
        </form>
	</div>
</body>
</html>
